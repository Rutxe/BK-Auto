<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Planificador de Ataques</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
        .entry { margin: 10px 0; }
        .entry input { padding: 5px; width: 150px; }
        #attackList { margin-top: 20px; }
        .attack-item { padding: 8px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; }
        .knight-list { border: 1px solid #ddd; max-height: 300px; overflow-y: auto; padding: 10px; margin-top: 20px; }
        .knight-item { cursor: pointer; padding: 5px; }
        .knight-item:hover { background-color: #f0f0f0; }
        .selected { background-color: #d1e7dd; }
        .manual-mode { margin-top: 20px; padding: 10px; border-top: 1px solid #ddd; }
        #autoButton { background-color: #dc3545; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        #autoButton.active { background-color: #28a745; }
    </style>
</head>
<body>
    <h1>Planificador de Ataques</h1>
    
    <!-- Modo automático -->
    <div class="entry">
        <input type="text" id="name" placeholder="Nombre" readonly>
        <input type="text" id="timeAuto" placeholder="hh.mm.ss">
        <button onclick="addAttack('auto')">Atacar</button>
    </div>

    <h2>Lista de Caballeros</h2>
    <div class="knight-list" id="knightList"></div>

    <!-- Modo manual -->
    <div class="manual-mode">
        <h3>Modo Manual</h3>
        <input type="text" id="urlManual" placeholder="URL completa">
        <input type="text" id="timeManual" placeholder="hh.mm.ss">
        <button onclick="addAttack('manual')">Atacar Manual</button>
    </div>

    <!-- Botón AUTO -->
    <div class="manual-mode">
        <button id="autoButton" onclick="toggleAuto()">AUTO</button>
    </div>

    <h2>Cola de Ataques</h2>
    <div id="attackList"></div>

    <script>
        const urlMappings = {
            // ... (todos los caballeros aquí, como en versiones anteriores)
        };

        let attacks = [];
        let autoInterval = null;
        let isAutoActive = false;

        // Función para obtener URLs aleatorias
        function getRandomUrls(count) {
            const urls = Object.entries(urlMappings);
            const selected = [];
            while (selected.length < count && selected.length < urls.length) {
                const randomIndex = Math.floor(Math.random() * urls.length);
                const [name, url] = urls[randomIndex];
                if (!selected.some(s => s.url === url)) {
                    selected.push({ name, url });
                }
            }
            return selected;
        }

        // Función principal del modo AUTO
        function runAuto() {
            // Ataques inmediatos
            const immediateAttacks = getRandomUrls(3);
            immediateAttacks.forEach(attack => {
                window.open(attack.url, '_blank');
            });

            // Programar próximos ataques
            const nextAttacks = getRandomUrls(3);
            nextAttacks.forEach(attack => {
                const randomDelay = 5 * 60 * 1000 + Math.random() * 60 * 1000; // 5-6 minutos
                const attackTime = new Date(new Date().getTime() + randomDelay);
                
                attacks.push({
                    name: `AUTO: ${attack.name}`,
                    time: attackTime,
                    url: attack.url
                });
            });

            attacks.sort((a, b) => a.time - b.time);
            updateAttackList();
        }

        // Control del botón AUTO
        function toggleAuto() {
            const button = document.getElementById('autoButton');
            if (isAutoActive) {
                clearInterval(autoInterval);
                autoInterval = null;
                isAutoActive = false;
                button.textContent = 'AUTO';
                button.classList.remove('active');
            } else {
                autoInterval = setInterval(runAuto, 6 * 60 * 1000); // Cada 6 minutos
                runAuto(); // Ejecución inicial
                isAutoActive = true;
                button.textContent = 'DETENER';
                button.classList.add('active');
            }
        }

        // Resto del código existente (loadKnightList, addAttack, updateAttackList, etc.)
        // ... 

        // Inicializar
        loadKnightList();
    </script>
</body>
</html>
